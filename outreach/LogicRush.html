<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Logic Rush | CPU Challenge | Interactive CS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bnu: {
                            primary: '#003366', // Deep Blue
                            accent: '#0055A4', // Brighter Blue
                            gold: '#C5A900'    // Academic Gold hints
                        }
                    },
                    fontFamily: {
                        sans: ['Roboto', 'sans-serif'],
                        mono: ['Roboto Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background-color: #0f172a;
            /* Slate 900 */
            color: #e2e8f0;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .retro-scanline {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* JW Nav Icon */
        .jw-nav {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            user-select: none;
            color: white;
            text-decoration: none;
            font-family: 'Roboto', sans-serif;
        }

        .jw-nav:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Custom scrollbar for leaderboard */
        .scroller::-webkit-scrollbar {
            width: 6px;
        }

        .scroller::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .scroller::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 3px;
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col">

    <!-- Header -->
    <nav
        class="bg-slate-900 border-b border-slate-700 p-3 flex items-center justify-between shrink-0 z-50 h-16 relative">
        <div class="flex items-center gap-4">
            <a href="index.html" class="jw-nav" title="Back to Hub">JW</a>
            <div>
                <h1 class="font-bold text-lg text-white tracking-tight flex items-center gap-2 font-sans">
                    <span class="material-icons text-indigo-400">memory</span>
                    Logic Rush
                </h1>
                <p class="text-[10px] text-slate-400 uppercase tracking-widest font-bold font-sans">CPU Optimization
                    Module</p>
            </div>
        </div>

        <!-- Stats in Header -->
        <div class="flex items-center gap-6">
            <div class="flex flex-col items-end">
                <div class="text-[10px] text-slate-400 uppercase tracking-widest font-bold font-sans">Score</div>
                <div class="text-xl font-bold text-green-400 leading-none" id="scoreDisplay">0</div>
            </div>
            <div class="flex flex-col items-end pl-6 border-l border-slate-700">
                <div class="text-[10px] text-slate-400 uppercase tracking-widest font-bold font-sans">Lives</div>
                <div class="text-lg font-bold text-red-400 leading-none tracking-widest" id="livesDisplay">|||</div>
            </div>
        </div>
    </nav>

    <!-- CODE INSTRUCTION PANEL -->
    <div id="instructionPanel"
        class="absolute top-20 left-0 w-full px-4 z-40 pointer-events-none transition-opacity duration-300 opacity-0 flex justify-center">
        <div class="bg-slate-800/90 border border-slate-600 rounded-lg p-3 shadow-xl backdrop-blur-sm max-w-2xl w-full">
            <div class="flex items-center gap-2 text-xs text-slate-400 mb-1 font-sans">
                <span class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></span>
                <span>CPU_INSTRUCTION_SET.js</span>
            </div>
            <code id="ruleText" class="text-sm md:text-base text-blue-300 font-bold block text-center py-2">
                // Initializing...
            </code>
            <div class="mt-2 flex justify-between text-xs font-bold text-slate-500 uppercase tracking-widest font-sans">
                <span>&lt; Tap Left</span>
                <span>Tap Right &gt;</span>
            </div>
        </div>
    </div>

    <!-- MAIN MENU SCREEN -->
    <div id="menuScreen"
        class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-slate-900/95 backdrop-blur-sm top-16">
        <div class="text-center space-y-6 max-w-md px-6">
            <div class="space-y-2">
                <h1
                    class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-cyan-400 font-sans">
                    LOGIC RUSH</h1>
                <p class="text-slate-400 text-sm font-sans">CS TASTER: BOOLEAN LOGIC & PROCESSING SPEED</p>
            </div>

            <div class="bg-slate-800 p-6 rounded-lg border border-slate-700 shadow-xl">
                <p class="mb-4 text-sm text-slate-300 font-sans">Sort the incoming data packets based on the algorithm
                    shown. Be
                    quick, CPU!</p>
                <button id="startBtn"
                    class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-6 rounded transition-all transform hover:scale-105 shadow-lg shadow-indigo-500/25 font-sans">
                    INITIALIZE SYSTEM
                </button>
            </div>

            <div class="text-xs text-slate-500 font-sans">
                v1.0.0 | SYSTEM READY
            </div>
        </div>
    </div>

    <!-- GAME OVER SCREEN -->
    <div id="gameOverScreen"
        class="hidden absolute inset-0 z-50 flex flex-col items-center justify-center bg-slate-900/95 backdrop-blur-sm top-16">
        <div class="w-full max-w-md px-6 flex flex-col items-center">
            <div class="text-center mb-8">
                <h2 class="text-5xl font-bold text-red-500 mb-4 font-sans">SYSTEM CRASH</h2>
                <div class="text-3xl text-white font-sans">FINAL SCORE: <span id="finalScore"
                        class="font-mono text-indigo-400">0</span></div>
            </div>

            <button id="restartBtn"
                class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-4 px-6 rounded shadow-lg transition-all transform hover:scale-105 font-sans">
                REBOOT SYSTEM
            </button>
        </div>
    </div>

    <!-- CANVAS LAYER -->
    <div class="flex-grow relative overflow-hidden">
        <canvas id="gameCanvas"></canvas>

        <!-- SCANLINE OVERLAY -->
        <div class="absolute inset-0 pointer-events-none retro-scanline z-10 opacity-30"></div>

        <!-- FEEDBACK OVERLAY (Visual pops) -->
        <div id="feedbackOverlay" class="absolute inset-0 pointer-events-none z-10 flex items-center justify-center">
        </div>
    </div>

    <!-- GAME LOGIC -->
    <script type="module">
        // --- GAME STATE ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let gameState = 'MENU'; // MENU, PLAYING, GAMEOVER
        let score = 0;
        let lives = 3;
        let packets = [];
        let particles = [];
        let lastTime = 0;
        let spawnTimer = 0;
        let spawnRate = 1500;
        let gameSpeed = 3;
        let currentRule = null;
        let rulePhase = 0;

        // Colors
        const COLORS = {
            BLUE: '#3B82F6',
            RED: '#EF4444',
            GREEN: '#10B981',
            YELLOW: '#F59E0B'
        };
        const COLOR_KEYS = Object.keys(COLORS);
        const SHAPES = ['CIRCLE', 'SQUARE', 'TRIANGLE'];

        // --- RULES ENGINE ---
        const RULES = [
            // Phase 0: Simple Color
            [
                {
                    code: "if (packet.color == 'RED') return LEFT;\\nelse return RIGHT;",
                    check: (p) => p.color === COLORS.RED ? 'left' : 'right'
                },
                {
                    code: "if (packet.color == 'BLUE') return RIGHT;\\nelse return LEFT;",
                    check: (p) => p.color === COLORS.BLUE ? 'right' : 'left'
                }
            ],
            // Phase 1: Simple Shape
            [
                {
                    code: "if (packet.shape == 'SQUARE') return LEFT;\\nelse return RIGHT;",
                    check: (p) => p.shape === 'SQUARE' ? 'left' : 'right'
                },
                {
                    code: "if (packet.shape == 'CIRCLE') return RIGHT;\\nelse return LEFT;",
                    check: (p) => p.shape === 'CIRCLE' ? 'right' : 'left'
                }
            ],
            // Phase 2: Compound Logic (AND/OR)
            [
                {
                    code: "if (packet.color == 'GREEN' && packet.shape == 'TRIANGLE') return LEFT;\\nelse return RIGHT;",
                    check: (p) => (p.color === COLORS.GREEN && p.shape === 'TRIANGLE') ? 'left' : 'right'
                },
                {
                    code: "if (packet.color == 'YELLOW' || packet.shape == 'SQUARE') return RIGHT;\\nelse return LEFT;",
                    check: (p) => (p.color === COLORS.YELLOW || p.shape === 'SQUARE') ? 'right' : 'left'
                }
            ],
            // Phase 3: Negative Logic
            [
                {
                    code: "if (packet.color != 'BLUE') return LEFT;\\nelse return RIGHT;",
                    check: (p) => p.color !== COLORS.BLUE ? 'left' : 'right'
                }
            ]
        ];

        // --- RESIZE HANDLER ---
        function resize() {
            // Adjust for header height (approx 64px)
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight - 64;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- GAME LOOP ---
        function startGame() {
            gameState = 'PLAYING';
            score = 0;
            lives = 3;
            packets = [];
            particles = [];
            gameSpeed = 3;
            spawnRate = 1500;
            rulePhase = 0;

            // UI Updates
            document.getElementById('menuScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('instructionPanel').classList.remove('opacity-0');
            updateHUD();
            pickNewRule();

            lastTime = performance.now();
            requestAnimationFrame(loop);
        }

        function pickNewRule() {
            const phaseRules = RULES[Math.min(rulePhase, RULES.length - 1)];
            currentRule = phaseRules[Math.floor(Math.random() * phaseRules.length)];

            // Animate text change
            const ruleText = document.getElementById('ruleText');
            ruleText.style.opacity = '0';
            setTimeout(() => {
                ruleText.innerText = currentRule.code;
                ruleText.style.opacity = '1';
            }, 200);
        }

        function spawnPacket() {
            const colorKey = COLOR_KEYS[Math.floor(Math.random() * COLOR_KEYS.length)];
            const shape = SHAPES[Math.floor(Math.random() * SHAPES.length)];

            packets.push({
                x: canvas.width / 2,
                y: -50,
                color: COLORS[colorKey],
                shape: shape,
                vx: (Math.random() - 0.5) * 1, // Slight drift
                vy: gameSpeed
            });
        }

        function createParticles(x, y, color) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color: color
                });
            }
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            document.getElementById('instructionPanel').classList.add('opacity-0');
            document.getElementById('gameOverScreen').classList.remove('hidden');
            document.getElementById('finalScore').innerText = score;
        }

        function loop(timestamp) {
            if (gameState !== 'PLAYING') return;

            const dt = timestamp - lastTime;
            lastTime = timestamp;

            // Spawning
            spawnTimer += dt;
            if (spawnTimer > spawnRate) {
                spawnPacket();
                spawnTimer = 0;
                // Ramp up difficulty
                if (spawnRate > 600) spawnRate -= 10;
                gameSpeed += 0.005;
            }

            // Logic
            update(dt);
            draw();

            requestAnimationFrame(loop);
        }

        function update(dt) {
            // Update Packets
            for (let i = packets.length - 1; i >= 0; i--) {
                const p = packets[i];
                p.y += p.vy;
                p.x += p.vx;

                // Off screen bottom = Miss
                if (p.y > canvas.height) {
                    lives--;
                    updateHUD();
                    packets.splice(i, 1);
                    createParticles(p.x, canvas.height - 20, '#ff0000');
                    if (lives <= 0) gameOver();
                }
            }

            // Update Particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.05;
                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function draw() {
            // Clear
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Divider
            ctx.beginPath();
            ctx.setLineDash([10, 10]);
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.strokeStyle = '#334155';
            ctx.stroke();
            ctx.setLineDash([]);

            // Draw Zones
            ctx.fillStyle = 'rgba(255, 255, 255, 0.03)';
            ctx.fillRect(0, 0, canvas.width / 2, canvas.height);

            // Draw Packets
            packets.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.shadowBlur = 15;
                ctx.shadowColor = p.color;

                const size = 30;

                if (p.shape === 'SQUARE') {
                    ctx.fillRect(p.x - size / 2, p.y - size / 2, size, size);
                } else if (p.shape === 'CIRCLE') {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, size / 2, 0, Math.PI * 2);
                    ctx.fill();
                } else if (p.shape === 'TRIANGLE') {
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y - size / 2);
                    ctx.lineTo(p.x + size / 2, p.y + size / 2);
                    ctx.lineTo(p.x - size / 2, p.y + size / 2);
                    ctx.fill();
                }
                ctx.shadowBlur = 0;
            });

            // Draw Particles
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            });
        }

        // --- INPUT HANDLING ---
        function handleInput(side) { // 'left' or 'right'
            if (gameState !== 'PLAYING' || packets.length === 0) return;

            // Get the lowest packet (first in FIFO queue)
            const targetPacket = packets[0];

            if (!targetPacket) return;

            // Validate
            const correctSide = currentRule.check(targetPacket);

            if (side === correctSide) {
                // Success
                score += 10;
                packets.shift(); // Remove packet
                createParticles(targetPacket.x, targetPacket.y, '#4ade80'); // Green confetti

                // Progression
                if (score > 0 && score % 100 === 0) {
                    rulePhase++;
                    if (rulePhase < RULES.length) pickNewRule();
                }
            } else {
                // Fail
                lives--;
                packets.shift();
                createParticles(targetPacket.x, targetPacket.y, '#ef4444'); // Red explosion

                // Flash Screen Red
                const overlay = document.getElementById('feedbackOverlay');
                overlay.style.backgroundColor = 'rgba(239, 68, 68, 0.2)';
                setTimeout(() => overlay.style.backgroundColor = 'transparent', 100);

                if (lives <= 0) gameOver();
            }
            updateHUD();
        }

        function updateHUD() {
            document.getElementById('scoreDisplay').innerText = score;
            document.getElementById('livesDisplay').innerText = 'I'.repeat(lives);
            document.getElementById('livesDisplay').style.color = lives === 1 ? '#ef4444' : '#f87171';
        }

        // Mouse/Touch Events
        canvas.addEventListener('mousedown', (e) => {
            if (gameState !== 'PLAYING') return;
            const x = e.clientX;
            if (x < window.innerWidth / 2) handleInput('left');
            else handleInput('right');
        });

        // --- BINDINGS ---
        document.getElementById('startBtn').addEventListener('click', startGame);
        document.getElementById('restartBtn').addEventListener('click', () => {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('menuScreen').classList.remove('hidden');
        });

        // Keyboard Controls
        window.addEventListener('keydown', (e) => {
            if (gameState !== 'PLAYING') return;
            if (e.key === 'ArrowLeft' || e.key === 'a') handleInput('left');
            if (e.key === 'ArrowRight' || e.key === 'd') handleInput('right');
        });

    </script>
    <footer class="fixed bottom-2 right-2 text-[10px] text-slate-600 pointer-events-none z-50">
        Made by James Williams. MIT Licensed.
    </footer>
</body>

</html>